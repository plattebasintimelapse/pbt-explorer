"use strict";function initialize(){var a=[{featureType:"water",stylers:[{color:"#446980"},{weight:2}]},{featureType:"road",stylers:[{visibility:"simplified"}]},{featureType:"road.highway",stylers:[{visibility:"off"},{color:"#202909"},{weight:.8}]},{featureType:"road.highway",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi",stylers:[{visibility:"off"}]},{featureType:"administrative",stylers:[{visibility:"on"}]},{featureType:"water",elementType:"labels",stylers:[{visibility:"off"}]},{},{featureType:"road",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit",stylers:[{visibility:"off"}]}],b=new google.maps.StyledMapType(a,{name:"Styled Map"}),c={zoom:7,maxZoom:13,minZoom:5,center:new google.maps.LatLng(41.643387,-101.612224),mapTypeControl:!1,panControl:!1,zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.LARGE,position:google.maps.ControlPosition.LEFT_CENTER},scaleControl:!1,streetViewControl:!1};map=new google.maps.Map(document.getElementById("map-canvas"),c),map.mapTypes.set("map_style",b),map.setMapTypeId("map_style");var d={keepSpiderfied:!0,legWeight:1};oms=new OverlappingMarkerSpiderfier(map,d);var e=new google.maps.FusionTablesLayer({map:map,suppressInfoWindows:!0,query:{select:"col2",from:"1JvJgh-o4GfNRLKAreWD9UiFJa5N0rqpS_Wq3xSNf",where:"col1 = 'Streams'"},options:{styleId:2,templateId:2}});e.setMap(map),bounds=new google.maps.LatLngBounds,north_bounds=new google.maps.LatLngBounds,south_bounds=new google.maps.LatLngBounds,loups_bounds=new google.maps.LatLngBounds,central_bounds=new google.maps.LatLngBounds,lower_bounds=new google.maps.LatLngBounds,getContent();new google.maps.InfoWindow({content:"Loading..."})}function getContent(){$.getJSON("https://spreadsheets.google.com/feeds/list/1XZx5wnIEaFy7sJ85KI4cJOPrgx4o87ZilsDxp9VNfhs/od6/public/values?alt=json",function(a){for(var b=0;b<a.feed.entry.length;b++){var c={location:a.feed.entry[b].gsx$title.$t,description:a.feed.entry[b].gsx$description.$t,lat:Number(a.feed.entry[b].gsx$lat.$t),"long":Number(a.feed.entry[b].gsx$long.$t),sub_basin:a.feed.entry[b].gsx$basin.$t,vimeoURL:a.feed.entry[b].gsx$vimeoid.$t,phocalstreamID:a.feed.entry[b].gsx$phocalstreamid.$t};longtermTLLocations.push(c)}setTLMarkers(map,longtermTLLocations)}),$.getJSON("https://spreadsheets.google.com/feeds/list/1Ko2Fnm2hLN-B_BpTkza-Mmp5X3c1aDBbwusvTpwo5Hc/od6/public/values?alt=json",function(a){for(var b=0;b<a.feed.entry.length;b++){var c={location:a.feed.entry[b].gsx$title.$t,description:a.feed.entry[b].gsx$description.$t,lat:Number(a.feed.entry[b].gsx$lat.$t),"long":Number(a.feed.entry[b].gsx$long.$t),sub_basin:a.feed.entry[b].gsx$basin.$t,picSource:a.feed.entry[b].gsx$source.$t};stillLocations.push(c)}setStillMarkers(map,stillLocations)})}function createTLMarker(a,b){var c='<iframe class="timelapse-video" src="http://player.vimeo.com/video/'+a.vimeoURL+'"frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>',d={path:google.maps.SymbolPath.CIRCLE,fillColor:"#6aaac3",fillOpacity:.8,scale:8,strokeColor:"rgba(106, 170, 195, 0.8)",strokeWeight:1},e=new google.maps.LatLng(a.lat,a.long),f=new google.maps.Marker({position:e,map:b,icon:d,title:a.location,html:'<h2 class="center">'+a.location+'</h2><div class="timelapse-video-container">'+c+"</div><p>"+a.description+"</p>"});bounds.extend(e),"north"==a.sub_basin&&north_bounds.extend(e),"south"==a.sub_basin&&south_bounds.extend(e),"loups"==a.sub_basin&&loups_bounds.extend(e),"central"==a.sub_basin&&central_bounds.extend(e),"lower"==a.sub_basin&&lower_bounds.extend(e),oms.addMarker(f),tlMarkers.push(f);var g=document.createElement("div");g.className="info-window-inner tl-location map-box box-shadow",g.innerHTML=f.html;var h={content:g,disableAutoPan:!1,maxWidth:0,pixelOffset:new google.maps.Size(-300,200),zIndex:null,closeBoxMargin:"15px;",closeBoxURL:"images/app/close.png",infoBoxClearance:new google.maps.Size(100,100),isHidden:!1,alignBottom:!0,pane:"floatPane",enableEventPropagation:!1};return google.maps.event.addListener(f,"click",function(){ib.close(),ib.setOptions(h),ib.open(b,f),b.setCenter(f.getPosition())}),f}function createStoryMarker(a,b){var c='<iframe class="timelapse-video" src="http://player.vimeo.com/video/'+a.vimeoURL+'"frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>',d={path:google.maps.SymbolPath.CIRCLE,fillColor:"#f45555",fillOpacity:.8,scale:8,strokeColor:"#f45555",strokeWeight:1},e=new google.maps.Marker({position:new google.maps.LatLng(a.long,a.lat),map:b,icon:d,title:a.location,html:"<h2>"+a.location+'</h2><div class="video-container">'+c+"</div><p>"+a.description+"</p>"});storyMarkers.push(e);var f=document.createElement("div");f.className="info-window-inner story-location map-box box-shadow",f.innerHTML=e.html;var g={content:f,disableAutoPan:!1,maxWidth:0,pixelOffset:new google.maps.Size(-300,200),zIndex:null,closeBoxMargin:"15px;",closeBoxURL:"images/app/close.png",infoBoxClearance:new google.maps.Size(150,150),isHidden:!1,alignBottom:!0,pane:"floatPane",enableEventPropagation:!1};return google.maps.event.addListener(e,"click",function(){ib.close(),ib.setOptions(g),ib.open(b,this)}),e}function createStillMarker(a,b){var c={path:google.maps.SymbolPath.CIRCLE,fillColor:"#f45555",fillOpacity:.8,scale:3,strokeColor:"#f45555",strokeWeight:1},d=new google.maps.LatLng(a.lat,a.long),e=new google.maps.Marker({position:d,map:b,icon:c,title:a.location,html:"<h2>"+a.location+"</h2><img src="+a.picSource+" /> <p>"+a.description+"</p>"});console.log(a.location),stillMarkers.push(e);var f=document.createElement("div");f.className="info-window-inner story-location map-box box-shadow",f.innerHTML=e.html;var g={content:f,disableAutoPan:!1,maxWidth:0,pixelOffset:new google.maps.Size(-300,200),zIndex:null,closeBoxMargin:"15px;",closeBoxURL:"images/app/close.png",infoBoxClearance:new google.maps.Size(100,100),isHidden:!1,alignBottom:!0,pane:"floatPane",enableEventPropagation:!1};return google.maps.event.addListener(e,"click",function(){ib.close(),ib.setOptions(g),ib.open(b,this)}),e}function setTLMarkers(a,b){for(var c=0;c<b.length;c++)createTLMarker(b[c],a)}function setStoryMarkers(a,b){for(var c=0;c<b.length;c++)createStoryMarker(b[c],a)}function setStillMarkers(a,b){for(var c=0;c<b.length;c++)createStillMarker(b[c],a)}function removeOverlay(){$("#overlay").fadeOut(1e3),setTimeout(function(){$("#overlay").remove()},500)}function introPrompt(){intro.animate({top:"45%"},500,"swing"),$("<div/>").attr({id:"overlay"}).appendTo("body").fadeIn(1e3),$("#intro-close").click(function(){removeOverlay(),intro.animate({top:"140%"},500,"swing").fadeOut(500),setTimeout(function(){intro.remove()},1e3),setTimeout(function(){side_legend.animate({right:"15px"},500,"swing")},500),setTimeout(function(){bottom_legend.animate({bottom:"0"},1e3,"swing")},500),setTimeout(function(){$("header").animate({top:"0"},500,"swing")},500)})}function toggleMarkers(a){for(var b=0;b<a.length;b++)a[b].setVisible(a[b].getVisible()?!1:!0)}function watchLegendChange(){$("#btn-timelapse").parent().addClass("active"),$("#btn-stills").parent().addClass("active"),$("#btn-timelapse").change(function(){toggleMarkers(tlMarkers)}),$("#btn-stills").change(function(){toggleMarkers(stillMarkers)}),$("#btn-stories").change(function(){toggleMarkers(storyMarkers)}),$("#btn-all").click(function(){map.fitBounds(bounds)}),$("#btn-northplatte").click(function(){map.fitBounds(north_bounds)}),$("#btn-southplatte").click(function(){map.fitBounds(south_bounds)}),$("#btn-theloups").click(function(){map.fitBounds(loups_bounds)}),$("#btn-centralplatte").click(function(){map.fitBounds(central_bounds)}),$("#btn-lowerplatte").click(function(){map.fitBounds(lower_bounds)})}var map,oms,ib=new InfoBox,bounds,north_bounds,south_bounds,loups_bounds,central_bounds,lower_bounds,tlMarkers=[],storyMarkers=[],stillMarkers=[],longtermTLLocations=[],storyLocations=[],stillLocations=[],intro=$("#intro"),side_legend=$("#legend"),bottom_legend=$("#location-select");google.maps.event.addDomListener(window,"load",initialize),google.maps.event.addDomListener(window,"resize",function(){var a=map.getCenter();google.maps.event.trigger(map,"resize"),map.setCenter(a),map.fitBounds(bounds),$(window).width()<=767&&s&&($("<div/>").attr({id:"overlay"}).appendTo("body").fadeIn(1e3),s=!1)});var s=!0;$(window).load(function(){introPrompt(),watchLegendChange()}),$(document).ready(function(){});